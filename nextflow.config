// Simplified Nextflow config with three profiles: local, dsi (docker), and imperial (singularity)
// - local: development on laptop/workstation using local executor
// - dsi: Docker-enabled profile for containerized execution
// - imperial: Singularity-enabled profile for the Imperial HPC (no Docker)

profiles {

    local {
        // simple local execution suitable for development
        process {
            executor = 'local'
            cpus = 1
            memory = '4 GB'
            time = { 1.h * task.attempt }
            errorStrategy = 'finish'
        }
        docker.enabled = false
        singularity.enabled = false
    }

    dsi {
        // Docker-enabled profile for container testing
        docker.enabled = true
        process {
            executor = 'local'
            cpus = 2
            memory = '8 GB'
            time = { 2.h * task.attempt }
            errorStrategy = 'retry'
            maxRetries = 2
        }
    }

    imperial {
        // Imperial profile: use Singularity (Docker not available) and a cluster executor
        docker.enabled = false
        singularity {
            enabled = true
            autoMounts = true
        }

        process {
            // Change executor to the cluster executor used at Imperial (pbspro by default here)
            executor = 'pbspro'
            errorStrategy = 'retry'
            maxRetries = 5
            maxErrors = '-1'
            cpus = { 1 * task.attempt }
            memory = { 6.GB * task.attempt }
            time = { 4.h * task.attempt }

            // A few common labeled resource presets (override per-process as needed)
            withLabel:process_single { cpus = 1; memory = { 6.GB * task.attempt }; time = { 4.h * task.attempt }}
            withLabel:process_low { cpus = { 2 * task.attempt }; memory = { 12.GB * task.attempt }; time = { 2.h * task.attempt }}
            withLabel:process_medium { cpus = { 8 * task.attempt }; memory = { 32.GB * task.attempt }; time = { 8.h * task.attempt }}
            withLabel:process_high { cpus = { 16 * task.attempt }; memory = { 64.GB * task.attempt }; time = { 24.h * task.attempt }}

            // common pipeline labels used by scQC-flow-like pipelines
            withLabel:process_dropletqc { cpus = 30; memory = '80.GB'; time = '2.h'}
            withLabel:process_seurat { cpus = 10; memory = '80.GB'; time = '2.h'}
            withLabel:process_reports { cpus = 8; memory = '20.GB'; time = '1.h'}
        }
    }

}

// Minimal params section (defaults can be overridden on the command line)
params {
    samples = "samples.csv"
    outputDir = "results"
}